<!DOCTYPE html>
<html>
    <head>
    <title>Red Jackets Fakebook</title>
    <link rel="stylesheet" href="css/jquery.mobile-1.0a1.min.css" />
    <script src="http://code.jquery.com/jquery-1.4.3.min.js"></script>
    <script src="scripts/jquery.mobile-1.0a1.min.js"></script>
    <script src="scripts/abcjs_basic_1.10-min.js" type="text/javascript"></script>
</head>
<body>

<div data-role="page" >

    <div data-role="header">
        <h1>Red Jackets Fakebook</h1>
    </div>

    <div data-role="content" style="text-align:center;">
        <select data-native-menu=false></select>

        <div id="notation"></div>
        <div id="midi"></div>
    </div>

    <div id=navbar>
        <ul>
            <li><a href=#settings data-icon=gear>Settings</a></li>
            <li><a href=#help data-icon=info>Help</a></li>
            <li><a href=#search data-icon=search>Search</a></li>
        </ul>
    </div>
</div>

<!-- --------------- Settings page ------------------ -->

<div id="settings" data-role="page">
    <div data-role="header">
        <h1>Red Jackets Fakebook</h1>
    </div>

    <div data-role="content" style="text-align:center;">
        <p>Welcome to the settings page!</p>
    </div>

    <div id=navbar_settings_page>
        <ul>
            <li><a href=#songs data-icon=gear>Songs</a></li>
            <li><a href=#help data-icon=info>Help</a></li>
            <li><a href=#search data-icon=search>Search</a></li>
        </ul>
    </div>

</div>

<!-- --------------- Help page ------------------ -->

<div id="help" data-role="page">
    <div data-role="header">
        <h1>Red Jackets Fakebook - Help</h1>
    </div>

    <div data-role="content" style="text-align:center;">
        <p>Welcome to the help page!</p>
    </div>

    <div id=navbar_help_page>
        <ul>
            <li><a href=#songs data-icon=gear>Songs</a></li>
            <li><a href=#settings data-icon=gear>Settings</a></li>
            <li><a href=#search data-icon=search>Search</a></li>
        </ul>
    </div>

</div>

<!-- --------------- Search page ------------------ -->

<div id="search" data-role="page">
    <div data-role="header">
        <h1>Red Jackets Fakebook - Search</h1>
    </div>

    <div data-role="content" style="text-align:center;">
        <p>Welcome to the search page!</p>
    </div>

    <div id=navbar_search_page>
        <ul>
            <li><a href=#songs data-icon=gear>Songs</a></li>
            <li><a href=#help data-icon=info>Help</a></li>
            <li><a href=#settings data-icon=gear>Settings</a></li>
        </ul>
    </div>

</div>
</body>
</html>

<script type="text/javascript">

    var songs_folder = 'songs'

    function parse_song_list(data) {

        var songs = data.split('\n');
        var number_of_songs = songs.length - 1

        for (var i = 0; i < number_of_songs; i++) {

            var song_name = songs[i].split(",")[0]
            var song_path = songs_folder + '/' + songs[i].split(",")[1]

            $("select").append ("<option value="+song_path+">"+song_name+" </option>");
        }
    }

    function render_song(path) {

        var padding = 25
        printerParams = { scale: 1.0,
                          staffwidth: get_width() - 2.2 * padding ,
                          paddingtop: padding,
                          paddingbottom: padding,
                          paddingright: padding,
                          paddingleft: 0,
                          editable: false }

        $.get(path, function(data) {
            ABCJS.renderAbc('notation', data, {}, printerParams);
            //ABCJS.renderMidi('midi', data, {}, {}, {})
        }, 'text');

        return false;
    }

    function get_width() {
        var ori = $(window).orientation;
        var width = (ori==90 || ori==-90) ? $(window).height() : $(window).width();
        return width;
    }

    $("#navbar").navbar ();
    $("#navbar_settings_page").navbar ();
    $("#navbar_help_page").navbar ();
    $("#navbar_search_page").navbar ();

     // Event handler when different song is selected
     $("select").bind ("change", function (event)
     {
         render_song($(this).val ());
     });

     // Event handler window resize event
     $(window).bind('resize', function(e)
     {
         render_song($("select").val ());
     });

    $.get('songs/_index_of_songs.txt',parse_song_list, 'text');

</script>
